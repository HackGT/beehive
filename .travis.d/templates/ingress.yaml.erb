apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: app-ingress
spec:
  rules:
  <% biodomes.each do |_, biodome| %>
  <% biodome['apps'].each do |app_name, app| %>
  <% if app_name == :main %>
  - host: hack.gt
  <% elsif biodome['name'] == "default" %>
  - host: <%= app['shortname'] %>.hack.gt
  <% else %>
  - host: <%= app['shortname'] %>.<%= biodome['name'] %>.hack.gt
  <% end %>
    http:
      paths:
      - backend:
          serviceName: <%= app['uid'] %>
          servicePort: <%= app['port'] or 80 %>
  <% end %>
  <% end %>
